services:
  registry:
    build:
      context: .
      dockerfile: docker/Dockerfile
    environment:
      - SCRIPT_NAME=${SCRIPT_NAME:-table_to_deltalake.py}
      # - DATASTACK=minnie65_phase3_v1
      # - VERSION=1412
      - TABLE_NAME=synapses_v1dd
      - POLARS_SKIP_CPU_CHECK=1
    volumes:
      # Mount CloudVolume secrets for CAVEclient access
      - ${HOME}/.cloudvolume/secrets:/root/.cloudvolume/secrets:ro
      # Mount scripts directory for development
      - ./scripts:/scripts:ro
    # platform: linux/amd64  # Commented out for Apple Silicon compatibility
    # Remove container after run
    profiles:
      - default
